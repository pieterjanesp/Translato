# nginx configuration for React SPA (Single Page Application)

server {
    # Listen on port 80 (HTTP)
    listen 80;

    # Server name (can be localhost, domain name, or IP)
    server_name localhost;

    # Root directory where files are served from
    root /usr/share/nginx/html;

    # Default file to serve
    index index.html;

    # Main location block - handles all requests
    location / {
        # try_files is CRITICAL for SPAs!
        # It tries to serve files in this order:
        # 1. $uri - Try the exact file requested (e.g., /assets/app.js)
        # 2. $uri/ - Try as a directory (e.g., /assets/)
        # 3. /index.html - Fallback to index.html (for React Router routes)
        #
        # Why this matters:
        # - User navigates to /dashboard in browser
        # - nginx tries to find /dashboard file → doesn't exist
        # - nginx tries /dashboard/ directory → doesn't exist
        # - nginx serves /index.html → React Router takes over!
        try_files $uri $uri/ /index.html;
    }

    # Enable gzip compression for text-based files
    # This makes your JS/CSS files 3x smaller during transfer
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/x-javascript
        application/xml+rss
        application/json;

    # Cache static assets aggressively
    # Files with hash in name (app-abc123.js) never change
    # Browser can cache them forever
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Don't cache index.html
    # This file determines which version of JS to load
    # Always fetch fresh so users get latest version
    location = /index.html {
        expires -1;
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
    }

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
